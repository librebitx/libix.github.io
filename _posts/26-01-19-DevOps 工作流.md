---
layout: default
title:   "DevOps 工作流"
date:   2026-01-18
blog-label: Notes
---

# [DevOps 工作流](/public/DevOps 工作流.html)

## 持续集成（CI）

### 待办

- 收集客户反馈的漏洞和功能优化等需求

### 开发

- 根据需求在本地开发代码

### 提交

- 将代码提交到仓库
  - [**Git**](https://librebitx.github.io/2026/01/11/Git/) 负责代码管理和版本控制

### 拉取

- 拉取仓库的代码到本地
  - **Jenkins** 监听到有提交代码，启动流水线，调度服务器去拉取代码

### 构建

- 将代码构建成与其内容对应的可执行文件（镜像、exe、zip、deb等）
  - 构建的过程中会进行单元测试，通过才会构建成文件
    - 单元测试：只测试最小的代码单元（通常是一个函数或一个类），并且不依赖任何外部环境
- 构建之后会给文件添加一个临时标签**推送**到制品库，以供后续回滚版本
  - 制品库：Docker Hub、Harbo 等

- 编译代码非常消耗计算能力，所以会用几台高配置的 CPU 服务器专门负责编译
  - Jenkins 会根据脚本，去唤醒服务器上的专业编译工具，并监控编译过程是否报错

### 测试

- 在已经准备好的测试环境中，自动运行测试用例
  - 并行策略： 测试用例可能有成千上万个，要消耗大量时间，把用例切分成份，分发给多台测试服务器同时跑
  - 环境隔离： 测试用例存在系统、版本等差异，构建服务器没法同时满足，所以必须分发到不同系统的机器上
    - 集成测试
    - 端到端测试
    - 接口测试
- 测试失败则立即停止，制品库中的文件会自动清除
- 测试通过则将制品库中该文件的标签标为合格，继续下一步
  - Jenkins 读取测试脚本，根据要求，调度合适的服务器，远程命令这台服务器去执行测试，并回收结果

## 基础设施即代码（IaC）

- 生产环境和测试环境是物理上（或逻辑上）隔离的两套服务器，比如在本地测试然后部署到云平台，这时候需要 **[Terraform](https://librebitx.github.io/2026/01/17/Terraform/)** 和 **[Ansible](https://librebitx.github.io/2026/01/10/Ansible/)** 来解决环境一致性的问题
- Terraform（管硬件：开服务器）和 Ansible（管软件：装配置）  不会部署到生产环境，通过 Jenkins 调度 

## 持续交付/部署（CD）

- 持续交付（Continuous Delivery）
  - 为了安全，在预发布阶段需要人工干涉确认（金融 / 核心系统常用）
- 持续部署（Continuous Deployment）
  - 没有人工干预自动发布（互联网 / 内部系统常用）

### 部署

- 将构建测试后的程序部署到真实生产环境
  - Jenkens 调度 [**Kubernetes**](https://librebitx.github.io/2026/01/09/Kubernetes/) 部署程序，至此，Jenkins 不再工作
  - Kbernetes 是给服务器用的容器调度操作系统，通过 IaC 部署到生产环境并持续运行
  

## 运维与监控（Ops）

### 运维

- K8s 作为管理者，提供自愈、负载均衡、自动伸缩

### 监控

- 实时监控优化后程序的指标

- 收集程序数据及日志并分析
  - K8s 作为被观测对象，向监控系统输出运行状态数据
  - Prometheus 负责收集数据，Grafana 负责把数据画成极其精美的仪表盘


### 反馈

- 收集客户和监控的需求与分析反馈给开发团队，重复上述流程
